name: Sync to Gitee (HTTPS Only)

on:
  push:
    branches: [ master ]
  workflow_dispatch: # 允许手动点击按钮触发

jobs:
  git-mirror:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码（必须下载完整历史，否则无法镜像）
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. 直接使用 Git 命令推送到 Gitee
      - name: Push to Gitee
        run: |
          # 配置 Gitee 远程地址，其中 ${{ secrets.GITEE_TOKEN }} 会自动读取你设置的 Token
          # 注意：这里使用了 github.repository 变量，它会自动获取 "你的GitHub用户名/仓库名"
          # 如果你的 Gitee 用户名和 GitHub 不一样，请手动修改下面的 URL
          
          git remote add gitee "https://renleihaokun:${{ secrets.GITEE_TOKEN }}@gitee.com/renleihaokun/${{ github.event.repository.name }}.git"
          
          # 这是一个保险措施，防止 Gitee 拒绝不相关的提交历史
          # 如果是第一次同步，建议先手动在 Gitee 建个空仓库，或者加上 -f 强制覆盖
          
          echo "正在推送到 Gitee..."
          git push --mirror gitee
